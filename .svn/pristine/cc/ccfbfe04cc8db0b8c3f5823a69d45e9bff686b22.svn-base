package com.doteyplay.support.loginportal;

import com.doteyplay.luna.client.AsynchronismClientManager;
import com.doteyplay.luna.client.ConnectionInfo;
import com.doteyplay.luna.common.action.BaseAction;
import com.doteyplay.luna.common.message.EncoderMessage;

public class LoginPortalService
{

	private static final long MAX_TIME_OUT = 5 * 1000;
	/**
	 * 认证服务器的信息
	 */
	private static final ConnectionInfo CONNECTION_INFO = null;
//	new ConnectionInfo(
//			ServerConfig.IDENTITY_SERVER_IP, ServerConfig.IDENTITY_SERVER_PORT,
//			120, MAX_TIME_OUT);

	/**
	 * 单例对象
	 */
	public static LoginPortalService instance = new LoginPortalService();

	private AsynchronismClientManager manager = new AsynchronismClientManager();

	/**
	 * 初始化同步操作的客户端管理的Manager
	 */
	private LoginPortalService()
	{
		manager.initial(CONNECTION_INFO, LoginPortalController.getInstance());
	}

	/**
	 * 获得单例的方式
	 * 
	 * @return
	 */
	public static LoginPortalService getInstance()
	{
		if (instance == null)
			instance = new LoginPortalService();
		return instance;
	}

	/**
	 * 同步调用消息的方法
	 * 
	 * @param encoderMessage
	 * @return
	 */
	public void invoke(EncoderMessage encoderMessage)
	{
		if (encoderMessage == null)
			return;
		if (!manager.invoke(encoderMessage))
		{
			BaseAction action = LoginPortalController.getInstance().getAction(
					encoderMessage.getCommandId());
			if (action != null)
				action.doAction(encoderMessage.getRoleId());
		}
	}
}
