//
//  RotatList.h
//  fancyHeart
//
//  Created by 秦亮亮 on 14-6-30.
//
//

#ifndef __fancyHeart__RotatList__
#define __fancyHeart__RotatList__
#define COMMON_DISTANCE  7//默认rotateList显示几个模版

#include <iostream>
#include "cocos2d.h"
#include "ui/UILayout.h"
#include "ui/UIScrollInterface.h"
#include "Manager.h"
using namespace cocos2d;
using namespace cocos2d::ui;

class RotateList:public Layout
{
public:
	static RotateList* create();
    virtual void onEnter() override;
    virtual ~RotateList();
    
    enum class EventType
    {
        SCROLL_MIDDLE,
        TOUCH_ITEM,
        SET_ITEM_DATA
    };
    typedef std::function<void(EventType,Widget*,int)> rotateListCallback;
    void addEventListener(const rotateListCallback& callback);
    
    virtual void update(float dt) override;//移动还有角度变化
    virtual bool init() override;
    //设置样式:此函数的参数分别是模版，弹窗大小，模版直接间距，正弦弧度的一个弧度的直线长度
    void setItemModel(Widget* model,float radius=0,Size panelSize = Size(0,0),float itemDistance=0);
    void setRoll(int index);//设置滚动到第几个在中间位置，从0起始
    
    Vector<Widget*>& getItems();//得到items
    void setNum(int num);
    void setSlider(Slider* slider);//设置滚动条
    int getMiddleIndex();//获取中间位置模版的index
    
private:
    void setMoveType(Node* widget,int x);
    void pushBackItem();
    void pushBackDefaultItem(int num);
    float goDistance;//触摸移动的横向位移
    void goBack();
    int itemNum;//需要制作多少模版
    void changePos(const Vec2 &realOffset);
    int haveItemNum;//整个显示界面当前放几个模版
    bool isBack;//是否回弹（当到最左边和最右边不能走到时候不能回弹）
    int tagNumAtMiddle;//在中间的模版的tag值,移动过程中此值为－1
    float getYPos(float x);//根据x左边求得y坐标
    void resetPos(int index);//重新设置坐标
    int picNum;//总共需要显示多少模版
    int showPicNum;//显示界面总共绘制几张图片
    void removeItem(ssize_t index);//去除图片
    void insertCustomItem(ssize_t index);//加图片
    int addToNum;//最前面去除了几张图片了（即后面加了几张图片）
    void changeMiddleEvent(Widget*widget,int middleNum);//移动到中间位置的回调函数
    void tellIndexEvent(Widget* item,int num);
    void touchEvent(cocos2d::Ref *pSender, TouchEventType type);
    ssize_t curSelectedIndex;//当前点击的item的index
    int total;
    Size panelSize;//窗口大小
    float itemDistance;//模版间间距
    float radius;//正弦弧度的一个弧度的直线长度
    void resetZOrder();
    void sliderEvent(Ref *pSender, Slider::EventType type);
    
protected:
    virtual bool scrollChildren(float touchOffsetX, float touchOffsetY);//移动坐标
    void handleReleaseLogic(const Vec2 &touchPoint);
    bool bePressed;
    float slidTime;
    Vec2 touchBeganPoint;
    Vec2 touchMovedPoint;
    Vec2 touchEndedPoint;
    Vec2 touchMovingPoint;

    virtual void checkChildInfo(int handleState,Widget* sender,const Vec2 &touchPoint) override;
    float childFocusCancelOffset;
    void change();
    
    Widget* model;//模版
    Vector<Widget*> items;
    rotateListCallback eventCallback;
    bool _bePressed;
    void startAutoScrollChildrenWithOriginalSpeed(const Vec2& dir, float v, bool attenuated, float acceleration);
    void stopAutoScrollChildren();
    Vec2 autoScrollDir;
    bool isAutoScrollSpeedAttenuated;
    float autoScrollOriginalSpeed;
    float autoScrollAcceleration;
    bool autoScroll;
    float autoScrollAddUpTime;
    
};
#endif /* defined(__fancyHeart__RotateList__) */